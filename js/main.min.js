/*!
 * @main.min.js
 * @JavaScript document for Wickenburg Zoning Map Viewer @ MAG
 * @For Production
 * @GilaBend-Project - v1.0.0 | 09-24-2015
 * @author Vern Wolfley
*/

function toggleContent(){$("#legend").is(":hidden")?($("#legend").fadeIn(),$("#legend").draggable({containment:"#mapDiv"}),$("#contentsOpen")):($("#legend").fadeOut(),$("#contentsOpen"))}function toggleMTool(){$("#mTool").is(":hidden")?($("#mTool").fadeIn(),$("#mTool").draggable({containment:"#mapDiv"}),$("#measureOpen")):($("#mTool").fadeOut(),$("#measureOpen"))}function togglePrint(){$("#printTool").is(":hidden")?($("#printTool").fadeIn(),$("#printTool").draggable({containment:"#mapDiv"}),$("#printOpen")):($("#printTool").fadeOut(),$("#printOpen"))}function toggleReportWindow(){$("#reportTool").is(":hidden")?(console.log("test"),$("#reportTool").fadeIn(),$("#reportTool").draggable({containment:"#mapDiv"})):($("#reportTool").fadeOut(),$("#reportOpen"))}require(["dojo/dom-construct","dojo/dom","dojo/on","dojo/parser","dojo/query","dojo/keys","esri/sniff","esri/map","esri/SnappingManager","esri/dijit/Measurement","esri/dijit/Scalebar","esri/dijit/HomeButton","esri/dijit/LocateButton","esri/dijit/Geocoder","esri/graphic","esri/geometry/Multipoint","esri/symbols/PictureMarkerSymbol","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleLineSymbol","esri/tasks/IdentifyTask","esri/tasks/IdentifyParameters","esri/dijit/Popup","dojo/_base/array","dojo/_base/Color","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/ImageParameters","esri/dijit/Legend","dijit/form/CheckBox","dijit/form/HorizontalSlider","dijit/form/HorizontalRule","dijit/form/HorizontalRuleLabels","js/vendor/bootstrapmap.min.js","esri/dijit/BasemapToggle","esri/layers/FeatureLayer","esri/dijit/PopupTemplate","esri/InfoTemplate","esri/symbols/SimpleMarkerSymbol","esri/dijit/Print","esri/tasks/PrintTemplate","esri/request","esri/config","dojo/domReady!"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O){function P(a){var c,d,e;return c=w.filter(a.parameters,function(a,b){return"Layout_Template"===a.name}),0===c.length?void console.log('print service parameters name for templates must be "Layout_Template"'):(d=c[0].choiceList,mapOnlyRemove=w.indexOf(d,"MAP_ONLY"),mapOnlyRemove>-1&&d.splice(mapOnlyRemove,mapOnlyRemove),e=w.map(d,function(a){var b=new M;return b.layout=b.label=a,b.format="PDF",b.layoutOptions={titleText:"Gila Bend Zoning"},b}),printer=new L({map:ea,templates:e,url:appConfig.printUrl},b.byId("printButton")),void printer.startup())}function Q(a){console.log("Something broke: ",a)}function R(){var a=this.dojoAttachPoint,b=Da[a].checked;b===!0&&fa.remove(),b!==!0&&(fa=ea.on("click",Z))}function S(a){var b=a.graphic?a.graphic:a.result.feature;b.setSymbol(Fa),U(a.result,b.symbol)}function T(a){if(a=a.results,a.length>0){W();for(var b=Fa,c=0;c<a.length;c++)U(a[c],b);V(a)}else alert("Sorry, address or place not found.")}function U(a,b){var c,d,e,f,g={};e=a.feature.geometry,g.address=a.name,g.score=a.feature.attributes.Score,c={address:g.address,score:g.score,lat:e.getLatitude().toFixed(2),lon:e.getLongitude().toFixed(2)},d=new J("${address}","Latitude: ${lat}<br/>Longitude: ${lon}<br/>Score: ${score}"),f=new o(e,b,c,d),ea.graphics.add(f)}function V(a){for(var b=new p(ea.spatialReference),c=0;c<a.length;c++)b.addPoint(a[c].feature.geometry);ea.setExtent(b.getExtent().expand(2))}function W(){ea.infoWindow.hide(),ea.graphics.clear()}function X(a,b,c){return new q({angle:0,xoffset:b,yoffset:c,type:"esriPMS",url:a,contentType:"image/png",width:12,height:24})}function Y(){identifyTask1=new t(appConfig.mainURL),identifyParamsTask1=new u,identifyParamsTask1.layerIds=[7],identifyParamsTask1.tolerance=3,identifyParamsTask1.returnGeometry=!0,identifyParamsTask1.layerOption=u.LAYER_OPTION_VISIBLE,identifyParamsTask1.width=ea.width,identifyParamsTask1.height=ea.height,identifyTask2=new t(appConfig.mainURL),identifyParamsTask2=new u,identifyParamsTask2.layerIds=[4],identifyParamsTask2.tolerance=3,identifyParamsTask2.returnGeometry=!0,identifyParamsTask2.layerOption=u.LAYER_OPTION_VISIBLE,identifyParamsTask2.width=ea.width,identifyParamsTask2.height=ea.height,identifyTask3=new t(appConfig.mainURL),identifyParamsTask3=new u,identifyParamsTask3.layerIds=[1],identifyParamsTask3.tolerance=3,identifyParamsTask3.returnGeometry=!0,identifyParamsTask3.layerOption=u.LAYER_OPTION_VISIBLE,identifyParamsTask3.width=ea.width,identifyParamsTask3.height=ea.height,identifyTask4=new t(appConfig.mainURL),identifyParamsTask4=new u,identifyParamsTask4.layerIds=[2],identifyParamsTask4.tolerance=3,identifyParamsTask4.returnGeometry=!0,identifyParamsTask4.layerOption=u.LAYER_OPTION_VISIBLE,identifyParamsTask4.width=ea.width,identifyParamsTask4.height=ea.height}function Z(a){for(var b=(ea.layerIds,$),c=0;c<b.length;c++){var d=b[c].layer.visible,e=b[c].id;"gbZoning"===e&&d===!0&&(identifyParamsTask1.layerIds=[7]),"gbZoning"===e&&d===!1&&(identifyParamsTask1.layerIds=[-1]),"tParcels"===e&&d===!0&&(identifyParamsTask2.layerIds=[1]),"tParcels"===e&&d===!1&&(identifyParamsTask2.layerIds=[-1]),"gbFlood"===e&&d===!0&&(identifyParamsTask3.layerIds=[1]),"gbFlood"===e&&d===!1&&(identifyParamsTask3.layerIds=[-1]),"gbPendFlood"===e&&d===!0&&(identifyParamsTask4.layerIds=[2]),"gbPendFlood"===e&&d===!1&&(identifyParamsTask4.layerIds=[-1])}identifyParamsTask1.geometry=a.mapPoint,identifyParamsTask1.mapExtent=ea.extent,identifyParamsTask2.geometry=a.mapPoint,identifyParamsTask2.mapExtent=ea.extent,identifyParamsTask3.geometry=a.mapPoint,identifyParamsTask3.mapExtent=ea.extent,identifyParamsTask4.geometry=a.mapPoint,identifyParamsTask4.mapExtent=ea.extent;var f=identifyTask1.execute(identifyParamsTask1).addCallback(function(a){return w.map(a,function(a){var b=a.feature;if(b.attributes.layerName=a.layerName,0!==b.attributes.OBJECTID){var c=new J;c.setTitle("Gila Bend Zoning"),c.setContent("Zoning Code: ${ZONING}<br>Zoning Description: ${DESCRIPTION}<br>Area: ${Shape_Area:NumberFormat}"),b.setInfoTemplate(c)}return b})}),g=identifyTask3.execute(identifyParamsTask3).addCallback(function(a){return w.map(a,function(a){var b=a.feature;if(b.attributes.layerName=a.layerName,0!==b.attributes.OBJECTID){var c=new J;c.setTitle("Flood Zone"),c.setContent("Flood Zone: ${ZONE}"),b.setInfoTemplate(c)}return b})}),h=identifyTask4.execute(identifyParamsTask4).addCallback(function(a){return w.map(a,function(a){var b=a.feature;if(b.attributes.layerName=a.layerName,0!==b.attributes.OBJECTID){var c=new J;c.setTitle("Pending Flood Zone"),c.setContent("Pending Flood Zone: ${FloodZone}"),b.setInfoTemplate(c)}return b})});ea.infoWindow.setFeatures([f,g,h]),ea.infoWindow.show(a.mapPoint)}d.parse(),esri.config.defaults.io.proxyUrl="proxy/proxy.ashx",esri.config.defaults.io.alwaysUseProxy=!1,b.byId("version").innerHTML=appConfig.Version;var $=[],_=[],aa=new r(r.STYLE_SOLID,new s(s.STYLE_SOLID,new x([0,128,255]),3),null),ba=new r(r.STYLE_BACKWARD_DIAGONAL,new s(s.STYLE_SOLID,new x([0,255,255]),2),new x([0,255,255,.25])),ca=new K("circle",26,null,new x([0,0,0,.25])),da=new v({fillSymbol:ba,markerSymbol:ca,visibleWhenEmpty:!1,hideDelay:-1},a.create("div")),ea=F.create("mapDiv",{extent:new esri.geometry.Extent(appConfig.initExtent),basemap:"streets",minZoom:11,maxZoom:19,showAttribution:!1,logo:!1,infoWindow:da,sliderPosition:"top-right",scrollWheelZoom:!0});ea.on("load",Y);var fa=ea.on("click",Z);ea.on("unload",Z);var ga=(new k({map:ea,scalebarUnit:"english"}),new l({map:ea,visible:!0},a.create("div",{id:"HomeButton"},"mapDiv","last")));ga._homeNode.title="Original Extent",ga.startup();var ha=new m({map:ea,visible:!0},a.create("div",{id:"LocateButton"},"mapDiv","last"));ha.startup();var ia=new G({map:ea,visible:!0,basemap:"satellite"},a.create("div",{id:"BasemapToggle"},"mapDiv","last"));ia.startup();var ja=new n({value:"",zoomScale:10,maxLocations:10,autoComplete:!0,minCharacters:1,arcgisGeocoder:{sourceCountry:"USA",placeholder:"530 W PIMA ST, Gila Bend, AZ",suffix:" Gila Bend, AZ"},map:ea},"geosearch");ja.startup(),ja.on("select",S),ja.on("findResults",T),ja.on("clear",W);var ka=N({url:appConfig.printUrl,content:{f:"json"}});ka.then(P,Q);var la=ea.addLayer(new H(appConfig.mainURL+"/5",{id:"gbBoundary",mode:H.MODE_ONDEMAND,visible:!0,opacity:1})),ma=ea.addLayer(new H(appConfig.mainURL+"/3",{id:"mpaBoundary",mode:H.MODE_ONDEMAND,visible:!0,opacity:1})),na=new z;na.layerIds=[1],na.layerOption=z.LAYER_OPTION_SHOW;var oa=ea.addLayer(new y(appConfig.mainURL,{id:"gbFlood",imageParameters:na,outFields:["*"],visible:!1,opacity:.65})),pa=new z;pa.layerIds=[2],pa.layerOption=z.LAYER_OPTION_SHOW;var qa=ea.addLayer(new y(appConfig.mainURL,{id:"gbPendFlood",imageParameters:pa,outFields:["*"],visible:!1,opacity:1})),ra=new z;ra.layerIds=[7],ra.layerOption=z.LAYER_OPTION_SHOW;var sa=ea.addLayer(new y(appConfig.mainURL,{id:"gbZoning",imageParameters:ra,outFields:["*"],visible:!0,opacity:.65})),ta="<strong>Parcel:  ${PG_APN}</strong><br><strong>Area:  ${Shape_Area:NumberFormat}</strong><br>",ua=new J("Gila Bend Parcels",ta),va=ea.addLayer(new H(appConfig.mainURL+"/4",{id:"gbParcels",visible:!1,opacity:1,mode:H.MODE_ONDEMAND,infoTemplate:ua,outFields:["*"]})),wa="<strong>${EMPNAME}</strong><hr class='pLine'>${TA_ADDRESS}<br>",xa=new J("Address",wa),ya=ea.addLayer(new H(appConfig.mainURL+"/0",{id:"gbAddress",visible:!0,opacity:1,mode:H.MODE_ONDEMAND,infoTemplate:xa,outFields:["*"]})),za=new z;za.layerIds=[6],za.layerOption=z.LAYER_OPTION_SHOW;var Aa=ea.addLayer(new y(appConfig.mainURL,{id:"gbSolar",imageParameters:za,outFields:["*"],visible:!1,opacity:.65})),Ba=ea.enableSnapping({snapKey:g("mac")?f.META:f.CTRL}),Ca=[{layer:va}];Ba.setLayerInfos(Ca);var Da=new j({map:ea,lineSymbol:aa},b.byId("measurementDiv"));Da.startup(),c(Da.area,"click",R),c(Da.distance,"click",R),c(Da.location,"click",R),$.push({layer:la,id:"gbBoundary",title:"Gila Bend Boundary"}),$.push({layer:ma,id:"mpaBoundary",title:"Municipal Planning Area Boundary"}),$.push({layer:oa,id:"gbFlood",title:"Gila Bend Flood Zone"}),$.push({layer:qa,id:"gbPendFlood",title:"Gila Bend Pending Flood Zone"}),$.push({layer:Aa,id:"gbSolar",title:"Gila Bend Solar Field Overlay"}),$.push({layer:sa,id:"gbZoning",title:"Gila Bend Zoning"}),$.push({layer:ya,id:"gbAddress",title:"Gila Bend Addresses"}),$.push({layer:va,id:"gbParcels",title:"Gila Bend Parcels"}),_.push({layer:la,id:"gbBoundary",title:"Gila Bend Town Boundary"}),_.push({layer:ma,id:"mpaBoundary",title:"Municipal Planning Area Boundary"}),_.push({layer:oa,id:"gbFlood",title:"Gila Bend Flood Zone"}),_.push({layer:qa,id:"gbPendFlood",title:"Gila Bend Pending Flood Zone"}),_.push({layer:Aa,id:"gbSolar",title:"Gila Bend Solar Field Overlay"}),_.push({layer:va,id:"gbParcels",title:"Gila Bend Parcels"}),_.push({layer:sa,id:"gbZoning",title:"Gila Bend Zoning"});var Ea=new A({map:ea,layerInfos:_},"legendDiv");Ea.startup(),w.forEach($,function(c){var d=c.title,e=new B({name:"checkBox"+c.layer.id,value:c.layer.id,checked:c.layer.visible,onChange:function(){var a=ea.getLayer(this.value);a.setVisibility(!a.visible),this.checked=a.visible}});a.place(e.domNode,b.byId("toggleDiv"));var f=a.create("label",{"for":e.name,innerHTML:"&nbsp;&nbsp;"+d},e.domNode,"after");a.place("<br>",f,"after")});var Fa=(new C({name:"slider1",value:oa.opacity,minimum:0,maximum:1,intermediateChanges:!0,discreteValues:11,style:"width:250px;",onChange:function(a){oa.setOpacity(a)}},"slider1"),new C({name:"slider2",value:sa.opacity,minimum:0,maximum:1,intermediateChanges:!0,discreteValues:11,style:"width:250px;",onChange:function(a){sa.setOpacity(a)}},"slider2"),X("img/blue-pin.png",0,12,35)),Ga=a.create("a",{"class":"action",id:"infoLink",innerHTML:"Assessor Info",href:"javascript: void(0);"},e(".actionList",ea.infoWindow.domNode)[0]);c(Ga,"click",function(){var a=ea.infoWindow.getSelectedFeature(),b=(window.location,"");console.log(a.attributes),b=appConfig.MaricopaAssessor+a.attributes.PG_APN,window.open(b)})}),$(document).ready(function(){$("#contentsOpen").fadeTo("slow"),$("#legend").fadeTo("slow"),$("#legend").draggable({containment:"#mapDiv"}),contentsOpen=$("#contentsOpen").height(),$("#contentsOpen").click(function(){toggleContent()})}),$(document).ready(function(){$("#measureOpen").fadeTo("slow"),$("#mTool").fadeTo("slow"),measureOpen=$("#measureOpen").height(),$("#mTool").css("top",measureOpen),$("#measureOpen").click(function(){toggleMTool()})}),$(document).ready(function(){$("#mTool").hide()}),$(document).ready(function(){$("#printOpen").fadeTo("slow"),$("#printTool").fadeTo("slow"),printOpen=$("#printOpen").height(),$("#printOpen").click(function(){togglePrint()}),$("#reportOpen").fadeTo("slow"),$("#reportTool").fadeTo("slow"),reportOpen=$("#reportOpen").height(),$("#reportOpen").click(function(){toggleReportWindow()})}),$(document).ready(function(){$("#printTool").hide(),$("#reportTool").hide()}),$(document).ready(function(){$("#legend").load("views/contents.html"),$("#helpContent").load("views/helpContent.html"),$("#aboutInfo").load("views/about.html"),$("#legalDisclaimer").load("views/legalDisclaimer.html"),$("#definitions").load("views/definitions.html"),$("#mTool").load("views/measureTool.html"),$("#helpTool").load("views/helpTool.html"),$("#printTool").load("views/printTool.html"),$("#helpPrint").load("views/helpPrint.html"),$("#reportTool").load("views/reportWindow.html")});