/*!
 * @main.min.js
 * @JavaScript document for Gila Bend Map Viewer @ MAG
 * @For Production
 * @GilaBend-Project - v1.0.2 | 10-13-2015
 * @author Vern Wolfley
*/

function toggleContent(){$("#legend").is(":hidden")?($("#legend").fadeIn(),$("#legend").draggable({containment:"#mapDiv"}),$("#contentsOpen")):($("#legend").fadeOut(),$("#contentsOpen"))}function toggleMTool(){$("#mTool").is(":hidden")?($("#mTool").fadeIn(),$("#mTool").draggable({containment:"#mapDiv"}),$("#measureOpen")):($("#mTool").fadeOut(),$("#measureOpen"))}function togglePrint(){$("#printTool").is(":hidden")?($("#printTool").fadeIn(),$("#printTool").draggable({containment:"#mapDiv"}),$("#printOpen")):($("#printTool").fadeOut(),$("#printOpen"))}function toggleReportWindow(){$("#reportTool").is(":hidden")?($("#reportTool").fadeIn(),$("#reportTool").draggable({containment:"#mapDiv"})):($("#reportTool").fadeOut(),$("#reportOpen"))}require(["dojo/dom-construct","dojo/dom","dojo/on","dojo/parser","dojo/query","dojo/keys","dojo/_base/array","dojo/_base/Color","dojo/_base/connect","esri/sniff","esri/map","esri/SnappingManager","esri/dijit/Measurement","esri/dijit/Scalebar","esri/dijit/HomeButton","esri/dijit/LocateButton","esri/dijit/Geocoder","esri/dijit/Popup","esri/graphic","esri/geometry/Multipoint","esri/symbols/SimpleMarkerSymbol","esri/symbols/PictureMarkerSymbol","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleLineSymbol","esri/tasks/IdentifyTask","esri/tasks/IdentifyParameters","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/FeatureLayer","esri/layers/ImageParameters","esri/dijit/Legend","dijit/form/CheckBox","dijit/form/HorizontalSlider","dijit/form/HorizontalRule","dijit/form/HorizontalRuleLabels","esri/dijit/BasemapToggle","esri/dijit/PopupTemplate","esri/InfoTemplate","esri/dijit/Print","esri/tasks/PrintTemplate","esri/request","esri/config","js/vendor/bootstrapmap.min.js","dojo/domReady!"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P){function Q(a){var c,d,e;return c=g.filter(a.parameters,function(a,b){return"Layout_Template"===a.name}),0===c.length?void console.log('print service parameters name for templates must be "Layout_Template"'):(d=c[0].choiceList,mapOnlyRemove=g.indexOf(d,"MAP_ONLY"),mapOnlyRemove>-1&&d.splice(mapOnlyRemove,mapOnlyRemove),e=g.map(d,function(a){var b=new M;return b.layout=b.label=a,b.format="PDF",b.layoutOptions={titleText:"Gila Bend Zoning"},b}),printer=new L({map:ga,templates:e,url:appConfig.printUrl},b.byId("printButton")),void printer.startup())}function R(a){console.log("Something broke: ",a)}function S(){var a=this.dojoAttachPoint,b=Ea[a].checked;b===!0&&ha.remove(),b!==!0&&(ha=ga.on("click",_))}function T(a){var b=a.graphic?a.graphic:a.result.feature;b.setSymbol(Ga),V(a.result,b.symbol)}function U(a){if(a=a.results,a.length>0){X();for(var b=Ga,c=0;c<a.length;c++)V(a[c],b);W(a)}else alert("Sorry, address or place not found.")}function V(a,b){var c,d,e,f,g={};e=a.feature.geometry,g.address=a.name,g.score=a.feature.attributes.Score,c={address:g.address,score:g.score,lat:e.getLatitude().toFixed(2),lon:e.getLongitude().toFixed(2)},d=new K("${address}","Latitude: ${lat}<br/>Longitude: ${lon}<br/>Score: ${score}"),f=new s(e,b,c,d),ga.graphics.add(f)}function W(a){for(var b=new t(ga.spatialReference),c=0;c<a.length;c++)b.addPoint(a[c].feature.geometry);ga.setExtent(b.getExtent().expand(2))}function X(){ga.infoWindow.hide(),ga.graphics.clear()}function Y(a,b,c){return new v({angle:0,xoffset:b,yoffset:c,type:"esriPMS",url:a,contentType:"image/png",width:12,height:24})}function Z(){identifyTask1=new y(appConfig.mainURL),identifyParamsTask1=new z,identifyParamsTask1.layerIds=[7],identifyParamsTask1.tolerance=3,identifyParamsTask1.returnGeometry=!0,identifyParamsTask1.layerOption=z.LAYER_OPTION_VISIBLE,identifyParamsTask1.width=ga.width,identifyParamsTask1.height=ga.height,identifyTask2=new y(appConfig.mainURL),identifyParamsTask2=new z,identifyParamsTask2.layerIds=[4],identifyParamsTask2.tolerance=3,identifyParamsTask2.returnGeometry=!0,identifyParamsTask2.layerOption=z.LAYER_OPTION_VISIBLE,identifyParamsTask2.width=ga.width,identifyParamsTask2.height=ga.height,identifyTask3=new y(appConfig.mainURL),identifyParamsTask3=new z,identifyParamsTask3.layerIds=[1],identifyParamsTask3.tolerance=3,identifyParamsTask3.returnGeometry=!0,identifyParamsTask3.layerOption=z.LAYER_OPTION_VISIBLE,identifyParamsTask3.width=ga.width,identifyParamsTask3.height=ga.height,identifyTask4=new y(appConfig.mainURL),identifyParamsTask4=new z,identifyParamsTask4.layerIds=[2],identifyParamsTask4.tolerance=3,identifyParamsTask4.returnGeometry=!0,identifyParamsTask4.layerOption=z.LAYER_OPTION_VISIBLE,identifyParamsTask4.width=ga.width,identifyParamsTask4.height=ga.height}function _(a){for(var b=(ga.layerIds,aa),c=0;c<b.length;c++){var d=b[c].layer.visible,e=b[c].id;"gbZoning"===e&&d===!0&&(identifyParamsTask1.layerIds=[7]),"gbZoning"===e&&d===!1&&(identifyParamsTask1.layerIds=[-1]),"gbParcels"===e&&d===!0&&(identifyParamsTask2.layerIds=[4]),"gbParcels"===e&&d===!1&&(identifyParamsTask2.layerIds=[-1]),"gbFlood"===e&&d===!0&&(identifyParamsTask3.layerIds=[1]),"gbFlood"===e&&d===!1&&(identifyParamsTask3.layerIds=[-1]),"gbPendFlood"===e&&d===!0&&(identifyParamsTask4.layerIds=[2]),"gbPendFlood"===e&&d===!1&&(identifyParamsTask4.layerIds=[-1])}identifyParamsTask1.geometry=a.mapPoint,identifyParamsTask1.mapExtent=ga.extent,identifyParamsTask2.geometry=a.mapPoint,identifyParamsTask2.mapExtent=ga.extent,identifyParamsTask3.geometry=a.mapPoint,identifyParamsTask3.mapExtent=ga.extent,identifyParamsTask4.geometry=a.mapPoint,identifyParamsTask4.mapExtent=ga.extent;var f=identifyTask1.execute(identifyParamsTask1).addCallback(function(a){return g.map(a,function(a){var b=a.feature;if(b.attributes.layerName=a.layerName,0!==b.attributes.OBJECTID){var c=new K;c.setTitle("Gila Bend Zoning"),c.setContent("Zoning Code: ${ZONING}<br>Zoning Description: ${DESCRIPTION}"),b.setInfoTemplate(c)}return b})}),h=identifyTask2.execute(identifyParamsTask2).addCallback(function(a){return g.map(a,function(a){var b=a.feature;if(b.attributes.layerName=a.layerName,0!==b.attributes.OBJECTID){var c=new K;c.setTitle("County Parcels"),c.setContent("Parcel: ${APN}"),b.setInfoTemplate(c)}return b})}),i=identifyTask3.execute(identifyParamsTask3).addCallback(function(a){return g.map(a,function(a){var b=a.feature;if(b.attributes.layerName=a.layerName,0!==b.attributes.OBJECTID){var c=new K;c.setTitle("Flood Zone"),c.setContent("Flood Zone: ${FloodZone}"),b.setInfoTemplate(c)}return b})}),j=identifyTask4.execute(identifyParamsTask4).addCallback(function(a){return g.map(a,function(a){var b=a.feature;if(b.attributes.layerName=a.layerName,0!==b.attributes.OBJECTID){var c=new K;c.setTitle("Pending Flood Zone"),c.setContent("Pending Flood Zone: ${FloodZone}"),b.setInfoTemplate(c)}return b})});ga.infoWindow.setFeatures([f,h,i,j]),ga.infoWindow.show(a.mapPoint)}d.parse(),esri.config.defaults.io.proxyUrl="proxy/proxy.ashx",esri.config.defaults.io.alwaysUseProxy=!1,b.byId("version").innerHTML=appConfig.Version;var aa=[],ba=[],ca=new w(w.STYLE_SOLID,new x(x.STYLE_SOLID,new h([0,128,255]),3),null),da=new w(w.STYLE_BACKWARD_DIAGONAL,new x(x.STYLE_SOLID,new h([0,255,255]),2),new h([0,255,255,.25])),ea=new u("circle",26,null,new h([0,0,0,.25])),fa=new r({fillSymbol:da,markerSymbol:ea,visibleWhenEmpty:!1,hideDelay:-1},a.create("div")),ga=P.create("mapDiv",{extent:new esri.geometry.Extent(appConfig.initExtent),basemap:"streets",minZoom:11,maxZoom:19,showAttribution:!1,logo:!1,infoWindow:fa,sliderPosition:"top-right",scrollWheelZoom:!0});ga.on("load",Z);var ha=ga.on("click",_);ga.on("unload",_);var ia=(new n({map:ga,scalebarUnit:"english"}),new o({map:ga,visible:!0},a.create("div",{id:"HomeButton"},"mapDiv","last")));ia._homeNode.title="Original Extent",ia.startup();var ja=new p({map:ga,visible:!0},a.create("div",{id:"LocateButton"},"mapDiv","last"));ja.startup();var ka=new I({map:ga,visible:!0,basemap:"satellite"},a.create("div",{id:"BasemapToggle"},"mapDiv","last"));ka.startup();var la=new q({value:"",zoomScale:10,maxLocations:10,autoComplete:!0,minCharacters:1,arcgisGeocoder:{sourceCountry:"USA",placeholder:"530 W PIMA ST, Gila Bend, AZ",suffix:" Gila Bend, AZ"},map:ga},"geosearch");la.startup(),la.on("select",T),la.on("findResults",U),la.on("clear",X);var ma=N({url:appConfig.printUrl,content:{f:"json"}});ma.then(Q,R);var na=ga.addLayer(new B(appConfig.mainURL+"/5",{id:"gbBoundary",mode:B.MODE_ONDEMAND,visible:!0,opacity:1})),oa=ga.addLayer(new B(appConfig.mainURL+"/3",{id:"mpaBoundary",mode:B.MODE_ONDEMAND,visible:!0,opacity:1})),pa=new C;pa.layerIds=[1],pa.layerOption=C.LAYER_OPTION_SHOW;var qa=ga.addLayer(new A(appConfig.mainURL,{id:"gbFlood",imageParameters:pa,outFields:["*"],visible:!1,opacity:.65})),ra=new C;ra.layerIds=[2],ra.layerOption=C.LAYER_OPTION_SHOW;var sa=ga.addLayer(new A(appConfig.mainURL,{id:"gbPendFlood",imageParameters:ra,outFields:["*"],visible:!1,opacity:1})),ta=new C;ta.layerIds=[4],ta.layerOption=C.LAYER_OPTION_SHOW;var ua=ga.addLayer(new A(appConfig.mainURL,{id:"gbParcels",imageParameters:ta,outFields:["*"],visible:!1,opacity:1})),va=new C;va.layerIds=[6],va.layerOption=C.LAYER_OPTION_SHOW;var wa=ga.addLayer(new A(appConfig.mainURL,{id:"gbSolar",imageParameters:va,outFields:["*"],visible:!1,opacity:1})),xa=new C;xa.layerIds=[7],xa.layerOption=C.LAYER_OPTION_SHOW;var ya=ga.addLayer(new A(appConfig.mainURL,{id:"gbZoning",imageParameters:xa,outFields:["*"],visible:!0,opacity:.65})),za="<strong>${EMPNAME}</strong>${TA_ADDRESS}<br>",Aa=new K("Address",za),Ba=ga.addLayer(new B(appConfig.mainURL+"/0",{id:"gbAddress",visible:!0,opacity:1,mode:B.MODE_ONDEMAND,infoTemplate:Aa,outFields:["*"]})),Ca=ga.enableSnapping({snapKey:j("mac")?f.META:f.CTRL}),Da=[{layer:ua}];Ca.setLayerInfos(Da);var Ea=new m({map:ga,lineSymbol:ca},b.byId("measurementDiv"));Ea.startup(),c(Ea.area,"click",S),c(Ea.distance,"click",S),c(Ea.location,"click",S),aa.push({layer:na,id:"gbBoundary",title:"Gila Bend Boundary"}),aa.push({layer:oa,id:"mpaBoundary",title:"Municipal Planning Area Boundary"}),aa.push({layer:qa,id:"gbFlood",title:"Gila Bend Flood Zone"}),aa.push({layer:sa,id:"gbPendFlood",title:"Gila Bend Pending Flood Zone"}),aa.push({layer:wa,id:"gbSolar",title:"Gila Bend Solar Field Overlay"}),aa.push({layer:ya,id:"gbZoning",title:"Gila Bend Zoning"}),aa.push({layer:Ba,id:"gbAddress",title:"Gila Bend Addresses"}),aa.push({layer:ua,id:"gbParcels",title:"Gila Bend Parcels"}),ba.push({layer:na,id:"gbBoundary",title:"Gila Bend Town Boundary"}),ba.push({layer:oa,id:"mpaBoundary",title:"Municipal Planning Area Boundary"}),ba.push({layer:qa,id:"gbFlood",title:"Gila Bend Flood Zone"}),ba.push({layer:sa,id:"gbPendFlood",title:"Gila Bend Pending Flood Zone"}),ba.push({layer:wa,id:"gbSolar",title:"Gila Bend Solar Field Overlay"}),ba.push({layer:ua,id:"gbParcels",title:"Gila Bend Parcels"}),ba.push({layer:ya,id:"gbZoning",title:"Gila Bend Zoning"});var Fa=new D({map:ga,layerInfos:ba},"legendDiv");Fa.startup(),g.forEach(aa,function(c){var d=c.title,e=new E({name:"checkBox"+c.layer.id,value:c.layer.id,checked:c.layer.visible,onChange:function(){var a=ga.getLayer(this.value);a.setVisibility(!a.visible),this.checked=a.visible}});a.place(e.domNode,b.byId("toggleDiv"));var f=a.create("label",{"for":e.name,innerHTML:"&nbsp;&nbsp;"+d},e.domNode,"after");a.place("<br>",f,"after")});var Ga=(new F({name:"slider1",value:qa.opacity,minimum:0,maximum:1,intermediateChanges:!0,discreteValues:11,style:"width:250px;",onChange:function(a){qa.setOpacity(a)}},"slider1"),new F({name:"slider2",value:ya.opacity,minimum:0,maximum:1,intermediateChanges:!0,discreteValues:11,style:"width:250px;",onChange:function(a){ya.setOpacity(a)}},"slider2"),Y("img/blue-pin.png",0,12,35)),Ha=a.create("a",{"class":"action",id:"infoLink",innerHTML:"Assessor Info",href:"javascript: void(0);"},e(".actionList",ga.infoWindow.domNode)[0]);c(Ha,"click",function(){var a=ga.infoWindow.getSelectedFeature(),b=(window.location,"");b=appConfig.MaricopaAssessor+a.attributes.APN,window.open(b)}),i.connect(fa,"onSelectionChange",function(){var a=fa.getSelectedFeature();a&&(a.attributes.APN?$("#infoLink").show():$("#infoLink").hide())})}),$(document).ready(function(){$("#contentsOpen").fadeTo("slow"),$("#legend").fadeTo("slow"),$("#legend").draggable({containment:"#mapDiv"}),contentsOpen=$("#contentsOpen").height(),$("#contentsOpen").click(function(){toggleContent()})}),$(document).ready(function(){$("#measureOpen").fadeTo("slow"),$("#mTool").fadeTo("slow"),measureOpen=$("#measureOpen").height(),$("#mTool").css("top",measureOpen),$("#measureOpen").click(function(){toggleMTool()})}),$(document).ready(function(){$("#mTool").hide()}),$(document).ready(function(){$("#printOpen").fadeTo("slow"),$("#printTool").fadeTo("slow"),printOpen=$("#printOpen").height(),$("#printOpen").click(function(){togglePrint()}),$("#reportOpen").fadeTo("slow"),$("#reportTool").fadeTo("slow"),reportOpen=$("#reportOpen").height(),$("#reportOpen").click(function(){toggleReportWindow()})}),$(document).ready(function(){$("#printTool").hide(),$("#reportTool").hide()}),$(document).ready(function(){$("#legend").load("views/contents.html"),$("#helpContent").load("views/helpContent.html"),$("#aboutInfo").load("views/about.html"),$("#legalDisclaimer").load("views/legalDisclaimer.html"),$("#definitions").load("views/definitions.html"),$("#mTool").load("views/measureTool.html"),$("#helpTool").load("views/helpTool.html"),$("#printTool").load("views/printTool.html"),$("#helpPrint").load("views/helpPrint.html"),$("#reportTool").load("views/reportWindow.html")});